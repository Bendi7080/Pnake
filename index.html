<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PNAKE LEGENDS: FINAL</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        #game-container { width: 100vw; height: 100vh; }
        .ui-screen { position: absolute; inset: 0; background: radial-gradient(circle at center, #1a0a1a 0%, #000 100%); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: 0.5s; }
        .auth-card { background: rgba(255, 255, 255, 0.03); padding: 40px; border-radius: 35px; border: 1px solid rgba(255, 182, 193, 0.3); text-align: center; box-shadow: 0 0 40px rgba(255, 105, 180, 0.15); backdrop-filter: blur(10px); width: 280px; }
        h1 { color: #ffb6c1; margin: 0 0 25px 0; letter-spacing: 7px; font-size: 36px; text-shadow: 0 0 15px #ffb6c166; }
        input { display: block; width: 100%; padding: 15px; margin: 12px 0; border-radius: 12px; border: 1px solid #333; background: rgba(0,0,0,0.5); color: white; outline: none; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 16px; border-radius: 30px; border: none; background: linear-gradient(45deg, #ffb6c1, #ff69b4); color: white; font-weight: bold; cursor: pointer; font-size: 18px; }
        .hidden { opacity: 0; pointer-events: none; visibility: hidden; }
    </style>
</head>
<body>

    <div id="auth-screen" class="ui-screen">
        <div class="auth-card">
            <h1>PNAKE</h1>
            <input type="text" id="nick" placeholder="–ù–ò–ö–ù–ï–ô–ú" autocomplete="off">
            <input type="password" id="pass" placeholder="–ü–ê–†–û–õ–¨">
            <button id="login-btn">–í–û–ô–¢–ò</button>
        </div>
    </div>

    <div id="game-container"></div>

<script>
/** 1. FIREBASE & CORE **/
const firebaseConfig = {
    apiKey: "AIzaSyCr28iNiurXgoZwbxOfast8R26ZiwVAR5Y",
    authDomain: "pnake3.firebaseapp.com",
    databaseURL: "https://pnake3-default-rtdb.firebaseio.com",
    projectId: "pnake3",
    appId: "1:796701048320:web:d88d06ada6e6e15a52e2e5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const App = {
    user: null,
    defaultData: { coins: 100, level: 1, xp: 0, highScore: 0, selectedSkin: 'classic', inventory: ['classic'], lastBonus: 0 },
    save: function() { if (this.user) db.ref('users/' + this.user.nick).update(this.user); },
    addXP: function(amount) {
        this.user.xp += amount;
        if (this.user.xp >= this.user.level * 100) { this.user.level++; this.user.xp = 0; return true; }
        return false;
    }
};

/** 2. LOGIN LOGIC **/
document.getElementById('login-btn').onclick = async function() {
    const nick = document.getElementById('nick').value.trim();
    const pass = document.getElementById('pass').value.trim();

    if (!nick || !pass) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ!");

    // –¢–≤–æ—è –ª–∏—á–Ω–∞—è –∑–∞—â–∏—Ç–∞
    if (nick === "Bendi7080" && pass !== "BestEhsona") {
        return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!");
    }

    try {
        const ref = db.ref('users/' + nick);
        const snap = await ref.get();
        if (!snap.exists()) {
            if (confirm("–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç?")) {
                App.user = { ...App.defaultData, nick, password: pass };
                await ref.set(App.user);
                startGame();
            }
        } else {
            const data = snap.val();
            if (data.password === pass) { App.user = data; startGame(); }
            else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
        }
    } catch (e) { alert("–û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!"); }
};

function startGame() {
    document.getElementById('auth-screen').classList.add('hidden');
    game.scene.start('MenuScene');
}

/** 3. SCENES **/
class BootScene extends Phaser.Scene {
    constructor() { super('BootScene'); }
    preload() {
        this.load.audio('eat', 'https://labs.phaser.io/assets/audio/SoundEffects/p-ping.mp3');
        this.load.image('spark', 'https://labs.phaser.io/assets/particles/blue.png');
    }
    create() { this.scene.start('MenuScene'); }
}

class MenuScene extends Phaser.Scene {
    constructor() { super('MenuScene'); }
    create() {
        const { width, height } = this.scale;
        this.add.text(width/2, 80, "PNAKE LEGENDS", { fontSize: '36px', fill: '#ffb6c1', fontStyle: 'bold' }).setOrigin(0.5);
        
        // –ë–æ–Ω—É—Å
        const now = Date.now();
        if (now - (App.user.lastBonus || 0) > 86400000) {
            App.user.coins += 50; App.user.lastBonus = now; App.save();
            alert("üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å +50 –º–æ–Ω–µ—Ç!");
        }

        // –ö–Ω–æ–ø–∫–∏
        const createBtn = (y, txt, sc) => {
            let b = this.add.container(width/2, y);
            let bg = this.add.rectangle(0,0, 220, 55, 0xffffff, 0.1).setStrokeStyle(1, 0xffb6c1).setInteractive();
            b.add([bg, this.add.text(0,0, txt, {fontSize:'20px'}).setOrigin(0.5)]);
            bg.on('pointerdown', () => this.scene.start(sc));
        };
        createBtn(300, "–ò–ì–†–ê–¢–¨", 'GameScene');
        createBtn(370, "–ú–ê–ì–ê–ó–ò–ù", 'ShopScene');
        createBtn(440, "–†–ï–ö–û–†–î–´", 'LeaderboardScene');

        if (App.user.nick === "Bendi7080") {
            let adm = this.add.text(width-30, 30, "‚öôÔ∏è", {fontSize:'30px'}).setInteractive();
            adm.on('pointerdown', () => { if(prompt("–ü–∞—Ä–æ–ª—å:") === "BestEhsona") this.scene.start('AdminScene'); });
        }
    }
}

class GameScene extends Phaser.Scene {
    constructor() { super('GameScene'); }
    create() {
        this.add.text(180, 300, "–ò–ì–†–ê\n(–Ω–∞–∂–º–∏ —á—Ç–æ–±—ã –≤—ã–π—Ç–∏)", {align:'center'}).setOrigin(0.5).setInteractive().on('pointerdown', () => this.scene.start('MenuScene'));
    }
}

class AdminScene extends Phaser.Scene {
    constructor() { super('AdminScene'); }
    create() {
        this.add.text(180, 50, "–ê–î–ú–ò–ù–ö–ê").setOrigin(0.5);
        let b = this.add.text(180, 200, "–î–û–ë–ê–í–ò–¢–¨ 1000 ü™ô").setOrigin(0.5).setInteractive();
        b.on('pointerdown', () => { App.user.coins += 1000; App.save(); alert("–û–∫!"); });
        this.add.text(180, 500, "–í–´–•–û–î").setOrigin(0.5).setInteractive().on('pointerdown', () => this.scene.start('MenuScene'));
    }
}

class ShopScene extends Phaser.Scene { constructor() { super('ShopScene'); } create() { this.add.text(180, 300, "–ú–ê–ì–ê–ó–ò–ù").setOrigin(0.5); this.add.text(180, 500, "–ù–ê–ó–ê–î").setOrigin(0.5).setInteractive().on('pointerdown', () => this.scene.start('MenuScene')); } }
class LeaderboardScene extends Phaser.Scene { constructor() { super('LeaderboardScene'); } create() { this.add.text(180, 300, "–õ–ò–î–ï–†–´").setOrigin(0.5); this.add.text(180, 500, "–ù–ê–ó–ê–î").setOrigin(0.5).setInteractive().on('pointerdown', () => this.scene.start('MenuScene')); } }

const config = { type: Phaser.AUTO, width: 360, height: 640, parent: 'game-container', backgroundColor: '#000', scene: [BootScene, MenuScene, GameScene, ShopScene, LeaderboardScene, AdminScene] };
const game = new Phaser.Game(config);
</script>
</body>
</html>
